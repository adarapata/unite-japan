Unityのシーンを紐解き把握するには

Unityフィールドエンジニア山村さん
フィールドエンジニア：技術相談・問題解決

今回の話
- プロジェクトをサクッと読む方法

なぜこんなのが必要？
- バグレポート構造解析
- サンプルシーンの解析
- コード書くの面倒
 - 昔作ったプロジェクトが読めない
 - もっと楽に解析できたら・・

なので今回は、シーンのメタデータを見ることにしよう
Unityの構造
- プロジェクト
 - シーン
  - オブジェクト
   - コンポーネント

- コンポーネントは基本的にコールバックで呼ばれる
Start Updateなどなど

動かない条件
- 非アクティブ
- コンポーネントがない
- 参照もコールバックもない

オブジェクトメッセージ

コンポーネントメッセージ
event
untiyevent
参照の構築が必要
GetComponentとかFindWithTagとか

オブジェクト生成ルール
Instantite

### ルールを元に情報を集める
コンポーネントも列挙
シーンの中のオブジェクト一覧をとって、コンポーネント一覧をとって、コールバック一覧を取得する

IEVENTSYSTEMHANDL
IEventSystemHandlerを継承しておくと、インスペクタにコールバック一覧を出せる

文字列のメソッドコール
AnimatonEvent,SendMessage,uGUIのEventSystem
これもコールバックとして列挙したいね

オブジェクトの参照関係の確認
参照元取れる？
無理
- なので消した時のリスクは不明
- 参照情報を元にリスト作ろう

参照先の座標の確認
参照元に矢印を出るように拡張した
少ないと便利だけど、大量にあった場合逆に混乱する

参照リストからの削除

参照関係なく、自己完結してるオブジェクトは非表示にしよう

## コンポーネントの依存関系
コンポーネント一覧から特定のコードを持つコンポーネントをっ確認

## グラフ化
正規表現でがんばる
設計的な話
Model
実際コンポーネントよりも通常クラスを使うことが
シングルトンで、マネージャというパターンが多い

ギミック系オブジェクト
- Colliderなどで自己完結
- ステージ系のとこでよく見る

UPDATEで頑張る丼
多くの参照を集めているタイプ
自前のUpdate保持してる
まあコード読むしかないよね

参照先の状態を見る
だれを見るではなく、どうやって見つかるか
Targetとかいうオブジェクトだったらだいたい座標だよね

参照関係の把握
自分で動くか管理されてるか

検索パターン
ユニークなタグ(Player)とかでFindされてるのよく見る
親子関係でつなぐのも見る
名前で直検索

対マネージャー
- マネージャーに登録しに行くパティーン
- マネージャーがコンポーネントを探すパティーン

なぜ参照するのか
- 検索キャッシュ
- 位置欲しい
- コンポーネント欲しい

よくわからんところに参照されてたらだいたいほげほげマネージャー

そのオブジェクトはどこから持ってきた？
ResourcesとかAssetBundleっとかはだいたい自前ラッパーがあるからそれを探さねば

該当のプレファブ探す方法
Refarence Viewer使うと便利

最終手段 YAMLをGREP
Unity5でUnityYAMLMergeなるものが追加
シーンやプレファブのマージが可能に

まとめ
- シーンが持つコンポーネントを知る
- オブジェクトの役割と参照関係
- オブジェクトが作られる条件
